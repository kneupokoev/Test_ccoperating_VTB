@startuml
|BackMyGemini|
start
:Инициировать начало проверки;
:Отправить запрос о наличии файла;
|ServicePointFileURL|
:Получить запрос;
:Проверить наличие файла;
:Отправить ответ;
|BackMyGemini|
:Получить ответ;
if (файл существует) then
  :Отправить запрос о корректности файла;
  else
  |Лог|
  :Создать запись об ошибке;
  end
  endif

|ServicePointFileURL|
:Получить запрос;
:Проверить корректность файла;
:Отправить ответ;
|BackMyGemini|
:Получить ответ;

if (файл корректен) then
  :проверить условие обновления файла;
  else
  |Лог|
  :Создать запись об ошибке;
  end
  endif

 |BackMyGemini| 
if (условие выполнено) then
  :Скачать файл;
  else
  end
  endif

repeat
  :Проверить наличие непроверенных строк;


 |BackMyGemini| 
if () then
  :Проверить количество непроверенных строк;
if (>=100) then
  :Получить 100 строк;
  else
  :Получить оставшиеся строки;
  endif

:Проверить запись;
:Запросить идентичный ServicePointCode;

|ServicePointFileURL|
:Получить запрос;
:Проверить идентичный ServicePointCode;
:Отправить ответ;

 |BackMyGemini| 
:Получить ответ;
:Проверить существование значения в ServicePointTypes;
:Проверить значение IsActive;



  else
  :Проверить наличие исключений;
 if (исключения есть) then
  |Лог|
  :Создать запись об ошибке;
  end
  else
  |BackMyGemini|
  :Отправить запрос на установку системной даты;
|ServicePointFileURL|
:Получить запрос;
:Обновить системную дату файла;
:Отправить ответ;
  |BackMyGemini|
  :Получить ответ;
  :Завершить процедуру обновления;
  end 
  endif
  endif

repeat while (Остались непроверенные строки?)

end
@enduml